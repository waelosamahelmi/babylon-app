# Auto-Update Feature for PlateOS

This adds automatic update checking and installation to your Android app.

## üöÄ Features

- ‚úÖ **Auto-check on startup** - Checks for updates when app launches
- ‚úÖ **Periodic checks** - Checks every hour while app is running
- ‚úÖ **Background checks** - Checks when app comes to foreground
- ‚úÖ **Manual check** - Users can manually check for updates
- ‚úÖ **Update dialog** - Beautiful dialog showing update details
- ‚úÖ **One-tap download** - Downloads and installs with one click
- ‚úÖ **Version comparison** - Smart version checking
- ‚úÖ **File size display** - Shows download size before updating

## üì¶ Installation

### 1. Install Required Capacitor Plugins

```bash
npm install @capacitor/app @capacitor/dialog @capacitor/browser
npx cap sync
```

### 2. Add Components to Your App

Add the `UpdateChecker` component to your main App component:

```tsx
// src/App.tsx
import { UpdateChecker, ManualUpdateButton } from '@/components/update-checker';

function App() {
  return (
    <div>
      {/* Add this at the top level of your app */}
      <UpdateChecker />
      
      {/* Your existing app content */}
      <YourAppContent />
      
      {/* Optional: Add manual update button in settings */}
      <ManualUpdateButton />
    </div>
  );
}
```

### 3. Update Version Number

Each time you release a new version, update the version in:

**File:** `src/hooks/use-app-updater.ts`
```typescript
const CURRENT_VERSION = '1.0.0'; // Change this with each release
```

Or better yet, sync it with `package.json`:

```typescript
import packageJson from '../../package.json';
const CURRENT_VERSION = packageJson.version;
```

## üéØ How It Works

### Automatic Update Flow

1. **App starts** ‚Üí Checks GitHub for latest release
2. **Compares versions** ‚Üí If newer version exists
3. **Shows dialog** ‚Üí User sees update details
4. **User clicks "Update Now"** ‚Üí APK downloads
5. **User installs** ‚Üí App updates automatically

### Version Format

The system supports two version formats:
- **Timestamp:** `20251126_183842` (generated by workflow)
- **Semantic:** `1.0.0`, `1.2.3`, etc.

### Update Checking

- **On startup:** Immediately when app launches
- **Hourly:** Every 60 minutes while running
- **On resume:** When app returns from background
- **Manual:** When user clicks "Check for Updates"

## ‚öôÔ∏è Configuration

### Change Check Frequency

Edit `src/hooks/use-app-updater.ts`:

```typescript
const CHECK_INTERVAL = 1000 * 60 * 60; // 1 hour
// Change to:
const CHECK_INTERVAL = 1000 * 60 * 60 * 24; // 24 hours
```

### Customize Dialog

Edit `src/components/update-checker.tsx` to change:
- Dialog appearance
- Button text
- Update message
- Colors and styling

### Silent Updates

To skip the dialog and download automatically:

```typescript
const showUpdateDialog = async (info: UpdateInfo) => {
  // Skip confirmation, download immediately
  downloadUpdate(info.downloadUrl);
};
```

## üîß Advanced Features

### Add to Settings Page

```tsx
// src/pages/settings.tsx
import { ManualUpdateButton } from '@/components/update-checker';

export function SettingsPage() {
  return (
    <div>
      <h2>App Settings</h2>
      
      <div className="update-section">
        <h3>Updates</h3>
        <ManualUpdateButton />
      </div>
    </div>
  );
}
```

### Show Current Version

```tsx
import { useAppUpdater } from '@/hooks/use-app-updater';

function AppInfo() {
  const CURRENT_VERSION = '1.0.0';
  
  return (
    <div>
      <p>Current Version: {CURRENT_VERSION}</p>
      <ManualUpdateButton />
    </div>
  );
}
```

### Custom Update Notification

```tsx
const { updateAvailable, updateInfo } = useAppUpdater();

return (
  <div>
    {updateAvailable && (
      <div className="notification">
        New version {updateInfo?.version} available!
      </div>
    )}
  </div>
);
```

## üì± User Experience

### First Time User Sees Update

1. App launches
2. 2-3 seconds later: Update dialog appears
3. Shows version, size, release date
4. "Update Now" or "Later" buttons

### If User Clicks "Later"

- Dialog closes
- App continues normally
- Will check again next hour
- Or when app is restarted

### If User Clicks "Update Now"

1. Browser opens with APK download
2. APK downloads to device
3. User gets notification when complete
4. Taps notification ‚Üí Install prompt
5. Installs update
6. App restarts with new version

## üîê Security

- ‚úÖ Downloads only from official GitHub releases
- ‚úÖ Uses HTTPS for all API calls
- ‚úÖ Verifies APK signature on install
- ‚úÖ No third-party update services

## üêõ Troubleshooting

### Updates Not Detected

Check that:
- GitHub release was created successfully
- APK file is attached to release
- Version number is higher than current
- Internet connection is working

### Download Fails

- Ensure user has storage permission
- Check internet connectivity
- Verify APK URL is accessible

### Version Always Shows as Old

Update the `CURRENT_VERSION` constant in `use-app-updater.ts`

## üìä Monitoring

Check update adoption:
- GitHub Insights ‚Üí Traffic ‚Üí Downloads
- See how many users download each release

## üé® Customization Ideas

### Add Release Notes

Fetch from GitHub release body:

```typescript
const releaseNotes = release.body;
// Show in dialog
```

### Force Update

For critical updates, don't allow "Later":

```typescript
if (isCriticalUpdate) {
  // Show dialog without cancel button
  // Block app usage until updated
}
```

### Update Progress

Show download progress (requires native code):

```typescript
// Track download progress
// Show progress bar
// Update percentage
```

## ‚úÖ Testing

1. **Lower version number** in `use-app-updater.ts`
2. **Build and install** app
3. **Create new release** on GitHub
4. **Open app** ‚Üí Should show update dialog
5. **Click "Update Now"** ‚Üí Should download APK

## üöÄ Production Checklist

- [ ] Set correct CURRENT_VERSION
- [ ] Test update flow
- [ ] Verify APK downloads correctly
- [ ] Check dialog appears properly
- [ ] Test "Later" and "Update Now" buttons
- [ ] Ensure update installs successfully
- [ ] Verify app restarts with new version
